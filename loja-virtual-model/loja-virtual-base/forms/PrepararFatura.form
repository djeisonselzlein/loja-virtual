<?xml version="1.0" encoding="UTF-8"?>
<com.whitestein.lsps.modeler.form:FormDefinition
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:com.whitestein.lsps.modeler.form="http:///com/whitestein/lsps/modeler/form.ecore"
    xmi:id="_KCA8QATAEeOYtrdguecaaw"
    name="PrepararFatura"
    newUI="true">
  <parameters
      xmi:id="_R-JsYATAEeOYtrdguecaaw"
      name="pedido"
      parameterType="Pedido"/>
  <formItem
      xsi:type="com.whitestein.lsps.modeler.form:NfdContainer"
      xmi:id="_KCA8QQTAEeOYtrdguecaaw"
      componentID="ROOT">
    <listeners
        xmi:id="_m-hjUATKEeOYtrdguecaaw"
        name="VALIDATE"
        listenerType="ACTION_LISTENER">
      <validators
          xmi:id="_m-hjUQTKEeOYtrdguecaaw"
          placement="CARREGAR_FATURA">
        <message><![CDATA[if isEmpty(faturas) or faturas[0].size = 0 then "Carregue uma fatura." end]]></message>
      </validators>
      <handle>pedido.arquivoFatura := faturas[0];</handle>
    </listeners>
    <child
        xsi:type="com.whitestein.lsps.modeler.form:NfdLayout"
        xmi:id="_O1jjwATAEeOYtrdguecaaw">
      <components
          xsi:type="com.whitestein.lsps.modeler.form:NfdReusable"
          xmi:id="_PkshsATAEeOYtrdguecaaw">
        <expression>ClienteDetalhe(pedido.cliente)</expression>
      </components>
      <components
          xsi:type="com.whitestein.lsps.modeler.form:NfdPanel"
          xmi:id="_3Y52oATAEeOYtrdguecaaw">
        <child
            xsi:type="com.whitestein.lsps.modeler.form:NfdLayout"
            xmi:id="_5mM0oATAEeOYtrdguecaaw">
          <components
              xsi:type="com.whitestein.lsps.modeler.form:NfdPanel"
              xmi:id="_9VhmEATAEeOYtrdguecaaw">
            <child
                xsi:type="com.whitestein.lsps.modeler.form:NfdTable"
                xmi:id="__x2ekATAEeOYtrdguecaaw">
              <columns
                  xmi:id="_5Wvm4ATBEeOYtrdguecaaw">
                <content
                    xsi:type="com.whitestein.lsps.modeler.form:NfdOutputText"
                    xmi:id="__VSo8ATBEeOYtrdguecaaw">
                  <content>itemPedido.produto.nome</content>
                </content>
                <header><![CDATA["Nome"]]></header>
              </columns>
              <columns
                  xmi:id="_5x1ncATBEeOYtrdguecaaw">
                <content
                    xsi:type="com.whitestein.lsps.modeler.form:NfdOutputText"
                    xmi:id="__-CD8ATBEeOYtrdguecaaw">
                  <content>itemPedido.quantidade</content>
                </content>
                <header><![CDATA["Quantidade"]]></header>
              </columns>
              <columns
                  xmi:id="_6JfScATBEeOYtrdguecaaw">
                <content
                    xsi:type="com.whitestein.lsps.modeler.form:NfdOutputText"
                    xmi:id="_AQzO8ATCEeOYtrdguecaaw">
                  <content>toString(itemPedido.custo)</content>
                </content>
                <header><![CDATA["Custo"]]></header>
              </columns>
              <columns
                  xmi:id="_XiLd0GR2EeWY2PN5hux4yQ">
                <content
                    xsi:type="com.whitestein.lsps.modeler.form:NfdOutputText"
                    xmi:id="_XiLd0WR2EeWY2PN5hux4yQ">
                  <content>toString(itemPedido.valorUnitario)</content>
                </content>
                <header><![CDATA["Val.Unitário"]]></header>
              </columns>
              <iterator><![CDATA[&itemPedido]]></iterator>
              <data>{index, count -> pedido.itens}</data>
              <type>TableType.simple</type>
            </child>
            <title><![CDATA["Itens Comprados"]]></title>
          </components>
          <components
              xsi:type="com.whitestein.lsps.modeler.form:NfdCheckBox"
              xmi:id="_OEQ-0ATCEeOYtrdguecaaw">
            <readonly>true</readonly>
            <binding><![CDATA[&pedido.urgente]]></binding>
            <label><![CDATA["Entrega Urgente"]]></label>
          </components>
          <components
              xsi:type="com.whitestein.lsps.modeler.form:NfdTextBox"
              xmi:id="_U8yV0ATCEeOYtrdguecaaw">
            <readonly>true</readonly>
            <binding><![CDATA[&custoTotal]]></binding>
            <label><![CDATA["Custo Total:"]]></label>
          </components>
          <components
              xsi:type="com.whitestein.lsps.modeler.form:NfdTextBox"
              xmi:id="_Wqj-gGRkEeWY2PN5hux4yQ">
            <readonly>true</readonly>
            <binding><![CDATA[&valorTotal]]></binding>
            <label><![CDATA["Valor Total:"]]></label>
          </components>
        </child>
        <title><![CDATA["Detalhes do Pedido"]]></title>
      </components>
      <components
          xsi:type="com.whitestein.lsps.modeler.form:NfdLayout"
          xmi:id="_OE1yUATdEeOTTdkRL7bwTQ"
          componentID="CARREGAR_FATURA"
          horizontal="true">
        <hints
            xmi:id="_btIK8ATzEeOTTdkRL7bwTQ"
            key="align"
            option="Bottom left"/>
        <components
            xsi:type="com.whitestein.lsps.modeler.form:NfdFileUpload"
            xmi:id="__2qbMATCEeOYtrdguecaaw">
          <listeners
              xmi:id="_v3CmsATLEeOYtrdguecaaw"
              listenerType="FILE_UPLOAD_LISTENER"
              refresh="FATURA_ATUAL"/>
          <triggerProcessingOnChange>true</triggerProcessingOnChange>
          <binding><![CDATA[&faturas]]></binding>
          <required>true</required>
          <label><![CDATA["Fatura"]]></label>
          <multiple>false</multiple>
          <uploadToMemory>true</uploadToMemory>
          <buttonText><![CDATA["Carregar"]]></buttonText>
        </components>
        <components
            xsi:type="com.whitestein.lsps.modeler.form:NfdLayout"
            xmi:id="_QSptsATdEeOTTdkRL7bwTQ"
            componentID="FATURA_ATUAL">
          <hints
              xmi:id="_YcWhQAT0EeOTTdkRL7bwTQ"
              key="align"
              option="Bottom left"/>
          <components
              xsi:type="com.whitestein.lsps.modeler.form:NfdConditional"
              xmi:id="_VoyxIATLEeOYtrdguecaaw"
              componentID="">
            <child
                xsi:type="com.whitestein.lsps.modeler.form:NfdFileDownload"
                xmi:id="_WeRnoATLEeOYtrdguecaaw">
              <text><![CDATA["Faturas atualmente carregadas (" + faturas[0].filename + ")"]]></text>
              <content>faturas[0]</content>
            </child>
            <visibleExpression>not isEmpty(faturas)</visibleExpression>
            <show></show>
          </components>
          <components
              xsi:type="com.whitestein.lsps.modeler.form:NfdConditional"
              xmi:id="_SguHwATdEeOTTdkRL7bwTQ">
            <child
                xsi:type="com.whitestein.lsps.modeler.form:NfdOutputText"
                xmi:id="_VBKEMATdEeOTTdkRL7bwTQ">
              <content><![CDATA["Ainda não carregada!"]]></content>
            </child>
            <visibleExpression>isEmpty(faturas)</visibleExpression>
            <show></show>
          </components>
        </components>
      </components>
      <components
          xsi:type="com.whitestein.lsps.modeler.form:NfdReusable"
          xmi:id="_Z8BWUATKEeOYtrdguecaaw">
        <listenerRefs
            xmi:id="_PUUiYATLEeOYtrdguecaaw"
            name="SUBMETER"
            componentID="ROOT"
            listenerName="VALIDATE"/>
        <expression>PainelDeBotoes(true)</expression>
      </components>
    </child>
  </formItem>
  <variables
      xmi:id="_EyYZMATBEeOYtrdguecaaw"
      name="itemPedido"
      variableType="ItemPedido"/>
  <variables
      xmi:id="_pmchcATCEeOYtrdguecaaw"
      name="custoTotal"
      variableType="String">
    <description></description>
    <initialValueExpression><![CDATA["R$ " + toString(getCustoTotal(pedido))]]></initialValueExpression>
  </variables>
  <variables
      xmi:id="_zSoR0AWREeOuld4RHdGSLw"
      name="faturas"
      variableType="Set&lt;File>">
    <initialValueExpression>{}</initialValueExpression>
  </variables>
  <variables
      xmi:id="_ZTr84GRkEeWY2PN5hux4yQ"
      name="valorTotal"
      variableType="String">
    <initialValueExpression><![CDATA["R$ " + toString(getValorTotal(pedido))]]></initialValueExpression>
  </variables>
  <description>Read/write form for invoice prepare with validation exposed.</description>
</com.whitestein.lsps.modeler.form:FormDefinition>
